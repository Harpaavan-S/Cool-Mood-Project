<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Feelings of the Day</title>
    <link href="https://fonts.googleapis.com/css2?family=Rock+Salt&family=Sacramento&family=Chewy&family=Gloria+Hallelujah&family=Righteous&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    <style>
        /* The same CSS as before, no changes needed */
    </style>
</head>
<body>

    <div class="background-shapes" id="background-shapes"></div>

    <div class="page-content">
        <h1 id="title">
            Feeling Good Today? <span id="emoji" class="emoji">ðŸ˜Š</span>
        </h1>

        <!-- Spotify Player Embed for All Moods -->
        <div id="spotify-container">
            <iframe id="spotify-player" class="spotify-player" 
                    src="https://open.spotify.com/embed/track/6i0V12jOa3mr6uu4WYhUBr?utm_source=generator" 
                    width="600" height="300" frameborder="0" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                    loading="lazy"></iframe>
        </div>

        <div class="container">
            <div class="column">
                <button class="button angry" id="angryBtn" aria-label="I am angry">Angry</button>
                <button class="button surprised" id="surprisedBtn" aria-label="I am surprised">Surprised</button>
                <button class="button happy" id="happyBtn" aria-label="I am happy">Happy</button>
            </div>
            <div class="column">
                <button class="button calm" id="calmBtn" aria-label="I am calm">Calm</button>
                <button class="button sad" id="sadBtn" aria-label="I am sad">Sad</button>
                <button class="button scared" id="scaredBtn" aria-label="I am scared">Scared</button>
            </div>
        </div>
    </div>

    <!-- Teachable Machine model integration -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image"></script>

    <script>
        const URL = "https://teachablemachine.withgoogle.com/models/dUneWpt7T/";
        let model, webcam, labelContainer, maxPredictions;

        async function init() {
            // Load the Teachable Machine model and metadata
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            // Set up webcam
            webcam = await tmImage.Webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);

            // Create label container for feedback (optional)
            labelContainer = document.getElementById("title");
        }

        async function loop() {
            // Update the webcam feed every frame
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            // Get predictions from Teachable Machine model
            const prediction = await model.predict(webcam.canvas);
            const highestPrediction = prediction[0].className;
            updatePageForMood(highestPrediction);
        }

        // This function changes the page dynamically based on the prediction
        function updatePageForMood(mood) {
            const moodSettings = {
                angry: { 
                    color: '#ff6b6b', 
                    emoji: 'ðŸ˜¡', 
                    trackUrl: 'https://open.spotify.com/embed/track/1P17dC1amhFzptugyAO7Il?utm_source=generator',
                    font: 'Roboto Slab',
                    title: 'Let it out! ðŸ˜¡',
                    background: 'radial-gradient(circle, #ff6b6b, #ff4d4d)'
                },
                happy: { 
                    color: '#f9e300', 
                    emoji: 'ðŸ˜Š', 
                    trackUrl: 'https://open.spotify.com/embed/track/32OlwWuMpZ6b0aN2RZOeMS?utm_source=generator',
                    font: 'Chewy', 
                    title: 'Enjoy the moment! ðŸ˜Š',
                    background: 'radial-gradient(circle, #f9e300, #f57c00)'
                },
                surprised: { 
                    color: '#ff9800', 
                    emoji: 'ðŸ˜²', 
                    trackUrl: 'https://open.spotify.com/embed/track/5UMgKsx50UqgN7VMNmeDuW?utm_source=generator',
                    font: 'Gloria Hallelujah',
                    title: 'Wow, that\'s unexpected! ðŸ˜²',
                    background: 'radial-gradient(circle, #ff9800, #ff5722)'
                },
                calm: { 
                    color: '#81c784', 
                    emoji: 'ðŸ˜Œ', 
                    trackUrl: 'https://open.spotify.com/embed/track/6pWgRkpqVfxnj3WuIcJ7WP?utm_source=generator',
                    font: 'Sacramento', 
                    title: 'Breathe and relax. ðŸ˜Œ',
                    background: 'radial-gradient(circle, #81c784, #4caf50)'
                },
                sad: { 
                    color: '#7986cb', 
                    emoji: 'ðŸ˜”', 
                    trackUrl: 'https://open.spotify.com/embed/track/3bNv3VuUOKgrf5hu3YcuRo?utm_source=generator',
                    font: 'Righteous', 
                    title: 'It\'s okay to feel down. ðŸ˜”',
                    background: 'radial-gradient(circle, #7986cb, #5c6bc0)'
                },
                scared: { 
                    color: '#9c27b0', 
                    emoji: 'ðŸ˜¨', 
                    trackUrl: 'https://open.spotify.com/embed/track/6i0V12jOa3mr6uu4WYhUBr?utm_source=generator',
                    font: 'Rock Salt', 
                    title: 'Stay strong! ðŸ˜¨',
                    background: 'radial-gradient(circle, #9c27b0, #6a1b9a)'
                }
            };

            // Update button styles
            document.querySelectorAll('.button').forEach(btn => btn.classList.remove('selected', 'greyed'));
            const selectedButton = document.getElementById(`${mood}Btn`);
            selectedButton.classList.add('selected');
            document.querySelectorAll('.button').forEach(btn => {
                if (btn !== selectedButton) {
                    btn.classList.add('greyed');
                }
            });

            // Update background and content based on mood
            document.body.style.backgroundColor = moodSettings[mood].color;
            document.getElementById('background-shapes').style.background = moodSettings[mood].background;
            document.getElementById('emoji').textContent = moodSettings[mood].emoji;
            document.getElementById('title').textContent = moodSettings[mood].title;

            // Adjust font for title based on the selected mood
            document.getElementById('title').style.fontFamily = moodSettings[mood].font;

            // Re-insert the Spotify iframe with autoplay
            document.getElementById('spotify-container').innerHTML = `<iframe id="spotify-player" class="spotify-player" 
                                                                      src="${moodSettings[mood].trackUrl}&autoplay=1" 
                                                                      width="600" height="300" frameborder="0" 
                                                                      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                                                                      loading="lazy"></iframe>`;
        }

        // Call init function when the page loads
        window.onload = init;
    </script>
</body>
</html>
